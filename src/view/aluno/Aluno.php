<?php

session_start();
if (!isset($_SESSION['username'])){?>

    <script>
        window.location="../../index.php";
    </script>

<?php }else{

    require '../../dbconf/db.php';
    require '../../dbconf/conexion.php';
    require '../../Query/Classes.php';
    require '../../Query/EstudantesSQL.php';


    $semestre = date('m') < 7 ? '1º':' 2º';
    $ano = date('Y');
    $classes = new Classes();
    $estudante_sql = new EstudantesSQL();
} ?>


<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type, refresh" content="text/html; charset=utf-8">
    <title>Registo Academico</title>
    <style>

        ul li {cursor: pointer}
        h5{background: none; }

        ul .lista_disciplinas{
            border-top: 1px solid #c6c6c6;
            padding: 8px;
        }

        li{list-style: none;  padding: -2em;}
        .doc_ul_a{ cursor: pointer;}

        .form-control{
            margin-top: 5px;
        }

    </style>

<?php
 include("../layouts/head.php");
?>


    <style>
    /**
        my stile sheet
    */

    .jumbotron  input, select, label, textarea, a, button{
    }
    .texto{
        color:green;
    }

</style>
    <script type="text/javascript" src="../fragments/js/js_estudante.js"></script>
    <script type="text/javascript" src="../fragments/js/aluno.js"></script>
</head>
<body>

        <div class="container">
            <?php

            $user =$_SESSION['username'];

            $query = "SELECT aluno.idaluno as number_row from aluno
                    INNER JOIN utilizador ON utilizador.id = aluno.idutilizador
                    WHERE utilizador.username='$user'";

            $qs= mysqli_query($con, $query);
            $count = mysqli_num_rows($qs);

            if ($count == 0){  require'../../Query/PessoaSQL.php'; ?>

                <form action="../../controller/FormandoCtr.php?acao=2" method="post">
                    <div style=" padding: 8px 30px;border-radius: 5px" class="col-sm-6">
                        <h4 style="color:green" class="alert alert-info">Identificação</h4>

                        <?php

                        if($_SESSION['tipo']!='estudante'){ ?>

                            <label for="pesquisar">Buscar Utilizador:  &nbsp;</label>
                            <input type="search" onkeyup="pesquisar(this.value,5)" id="auto_encarregado" class="form-control" autocomplete="off">
                            <ul class="list-group list_view_encarregado"></ul>
                            <input type="hidden" name="campo_utilizador" id="campo_utilizador" value=""/>

                            <input type="hidden" name="campo_utilizador" id="campo_utilizador" value="<?php echo $_REQUEST['acao'];?>"/>

                        <?php }else{ ?>

                            <input type="hidden" name="campo_utilizador" id="campo_utilizador" value="<?php echo $_SESSION['id'];?>"/>

                        <?php }?>

                        <label for="apelido">Apelido:</label><input type="text" id="apelido" required name="apelido" value="" class="form-control"/>
                        <label for="name">Nome:</label><input type="text" id="nome" name="nome" value="" class="form-control" required/>
                        <label for="bi_recibo">BI/Recibo/Passaporte:</label>
                        <input type="text" id="bi_recibo" name="bi_recibo" value="" class="form-control" required/>

                        <label for="estadocivil">Estado Civil:</label>
                        <select class="form-control" data-style="btn-primary" data-width="auto" id="estadocivil" name="estadocivil">
                            <option value="0" desabled="desabled">Selecionar Estado Civil</option>
                            <?php

                            $resut = mysqli_query($con,'SELECT * FROM estado_civil');
                            while ($row = mysqli_fetch_assoc($resut)){ ?>
                                <option value="<?php echo $row['idestadocivil'] ?>"><?php echo $row['descricao']?></option>

                            <?php }  ?>

                        </select>


                        <div class="regista_aluno">

                            <h4 style="color:green" class="alert alert-info">Endereço e Informações Medicas</h4>

                            <label for="endereco">Morada:</label>

                            <select class="form-control" data-style="btn-primary" data-width="auto" id="endereco" name="endereco" required>

                                <option value="0" desabled="desabled">Selecionar o bairro</option>
                                <?php
                                $resut = mysqli_query($con,'SELECT * FROM endereco');
                                while ($row = mysqli_fetch_assoc($resut)){ ?>
                                    <option value="<?php echo $row['idendereco'] ?>"><?php echo $row['bairro']?></option>
                                <?php }  ?>
                            </select>

                            <label for="provincia">Provincia de Nascimento: </label>

                            <select class="form-control" onchange="buscar_distrito(this.value)" data-style="btn-primary"
                                    data-width="auto" id="provincia" name="provincia">
                                <option value="0" desabled="desabled">Selecionar a Provincia</option>

                                <?php
                                $resut = mysqli_query($con,'SELECT * FROM provincia ORDER BY descricao ASC ');
                                while ($row = mysqli_fetch_assoc($resut)){ ?>
                                    <option value="<?php echo $row['idprovincia'] ?>"><?php echo $row['descricao']?></option>
                                <?php } ?>

                            </select>

                            <label for="distrito">Distrito:</label>
                            <select class="form-control first_select" data-style="btn-primary" data-width="auto" id="distrito" name="distrito">
                            </select>
                            <div class="lista_distritos"></div>

                            <h3 class="sucesso_reg_est" style="color:blue" align="right"></h3>
                            <label for="provincia">Sofre Alguma Doença?:</label>

                            <input type="text" class="form-control"  name="doenca" value="" id="doenca" placeholder="Indique o Nome da Doença"/>
                            <!--                            <label for="notas">Orientações Medicas *:</label>-->
                            <!--                            <textarea class="form-control" id="notas" name="notas"></textarea>-->
                            <!---->
                            <!--                            <label for="notas">Possui Alergia*:</label>-->
                            <!--                            <input type="text" class="form-control"  name="alergia" value="" id="alergia" placeholder="Registar o tipo de alergia a Alimentos"/>-->

                            <br>
                            <div class="pull-right">
                                <button class="btn btn-primary" id="salvar_est">Registar Operação</button>

                            </div>

                        </div>

                        <!--                            <label for="data_nascimento">Data de Nacimento:</label>-->
                        <!--                            <input type="date" id="data_nascimento" name="data_nascimento" value="" class="form-control" required/>-->
                        <!---->
                        <!--                            <label for="nivelescolar">Nivel Escolar:</label>-->
                        <!--                            <select class="form-control" data-style="btn-primary" data-width="auto" id="nivelescolar" name="nivelescolar">-->
                        <!--                                <option value="0" desabled="desabled">Selecionar nivel escolar</option>-->
                        <!--                                --><?php
                        //                                $resut = mysqli_query($con,'SELECT * FROM nivelescolar');
                        //                                while ($row = mysqli_fetch_assoc($resut)){ ?>
                        <!--                                    <option value="--><?php //echo $row['idnivel'] ?><!--">--><?php //echo utf8_encode($row['descricao']) ?><!--</option>-->
                        <!--                                --><?php //}  ?>
                        <!--                            </select>-->

                    </div> <!-- fim primeiro bloco---->


                </form>

            <?php }else{?>


                <?php include 'buscar_aluno.php';?>
                <?php include 'disciplina_aluno.php';

            }?>

        </div>

        <?php
        include("form_aluno.php");
        include("form_encarregado.php");
        include("list_encarregado.php");

        ?>

     </body>
</html>



<script type="text/javascript">

    $(document).ready(function(){

        var curso = $('select#curso_id').val();

        load_table_matricula(curso,0,0,8,3,0);
        $( "#guardar_inscricao" ).submit(function( event ) {
            // $('#btn_inscricaov').attr("disabled", true);
            var parametros = $(this).serialize();

            $.ajax({
                type: "POST",
                url: "../controller/FormandoCtr.php?acao=4",
                data: parametros,
                beforeSend: function(objeto){
                    $(".msg_sucesso").html("Mensagem: Carregando...");
                },
                success: function(datos){
                    $(".msg_sucesso").html(datos);
                    //$('#btn_inscricaov').attr("disabled", false);
                }
            });
            event.preventDefault();
        })

        $('.active_btn').click(function(){
            $('#btn_inscricaov').attr("disabled", false);
        });
    });

    function desable_exame_especial(aluno, inscricao){
        //alert(inscricao);
        $cont=2;
        $.ajax({
            type: "POST",
            url: "../../controller/FormandoCtr.php?acao=15&idaluno=" +aluno + '&idinsc='+inscricao + '&controlo='+ $cont,
            data: "idaluno"+aluno,"idinsc":inscricao, "controlo":$cont,
            beforeSend: function(objeto){
                $(".msg_sucesso").html("Mensagem: Carregando...");
            },
            success: function(datos){
                $(".msg_sucesso").html(datos);
            }
        });
        event.preventDefault();
    }


    function enable_inscricao(){
        $('#guardar_inscricao').show();
        $('.tbl_disciplina').hide();

    }

        function get_item_val(item){
            $('#campo_frm').val(item);
        }


        function listar_Encarregado(id){

            $(this).css('background','red');

            $.ajax({
                url:"../../controller/FormandoCtr.php",
                data:{id:id, acao:14},
                success:function(data){
                    $('.list_encarregado').html(data)
                }
            });

        }

        function obtener_datos(id){

            var nombre_cliente = $("#nombre_cliente"+id).val();
            var telefono_cliente = $("#telefono_cliente"+id).val();
            var email_cliente = $("#email_cliente"+id).val();
            var direccion_cliente = $("#direccion_cliente"+id).val();
            var status_cliente = $("#status_cliente"+id).val();

            $("#mod_nombre").val(nombre_cliente);
            $("#mod_telefono").val(telefono_cliente);
            $("#mod_email").val(email_cliente);
            $("#mod_direccion").val(direccion_cliente);
            $("#mod_estado").val(status_cliente);
            $("#mod_id").val(id);

        }

        function eliminar (id)
        {

            var q= $("#q").val();
            if (confirm("Realmente desejas eliminar este aluno")){
                $.ajax({
                    type: "GET",
                    url: "./ajax/buscar_clientes.php",
                    data: "id="+id,"q":q,
                    beforeSend: function(objeto){
                        $("#resultados").html("Mensagem: Carregando...");
                    },
                    success: function(datos){
                        $("#resultados").html(datos);
                        load(1);
                    }
                });
            }
        }


        function desable_exame_especial(aluno, disp){
            alert(disp+" "+aluno)

        }

        function enable_exame_especial(aluno, inscricao){
            //alert(inscricao);
            $cont=1;
            $.ajax({
                type: "POST",
                url: '../../controller/FormandoCtr.php?acao=15&idaluno=' +aluno + '&idinsc='+inscricao + '&controlo=' + $cont,
                data: "idaluno"+aluno,"idinsc":inscricao, "controlo":$cont,
                beforeSend: function(objeto){
                    $(".msg_sucesso").html("Mensagem: Carregando...");
                },
                success: function(datos){
                    $(".msg_sucesso").html(datos);
                }
            });
            event.preventDefault();
        }

</script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        